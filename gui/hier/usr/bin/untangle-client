#!/bin/sh

# Copyright (c) 2003-2007 Untangle, Inc.
# All rights reserved.
#
# This software is the confidential and proprietary information of
# Untangle, Inc. ("Confidential Information"). You shall
# not disclose such Confidential Information.
#
# $Id: untangle-client,v 1.11 2005/02/24 04:38:35 inieves Exp $


JAVA_HOME=${JAVA_HOME:-/opt/java}

export JAVA_HOME

HOST=${1:-localhost}

if ps aux -w -w | grep -q -E 'bin/java.+http://'$HOST'/webstart/.+\.jnlp$' ; then
  echo "Untangle Client already running, aborting..."
  exit 1
fi

echo "Initializing Webstart configuration: ${HOME}/.java/.deployment/deployment.properties"
${JAVA_HOME}/bin/javaws -updateVersions

#echo "Attempting to clear Webstart cache"
#${JAVA_HOME}/bin/javaws -Xclearcache

if [ -f /usr/share/metavize/.cdinstall ] ; then
  jnlpFile=gui-local-cd.jnlp
else
  jnlpFile=gui-local.jnlp
fi

webstartURL=http://$HOST/webstart/$jnlpFile

echo "Webstarting Untangle Client.  Connecting to: $webstartURL"
exec ${JAVA_HOME}/bin/javaws -Xnosplash $webstartURL

