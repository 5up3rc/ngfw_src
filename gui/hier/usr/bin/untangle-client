#! /bin/bash

source @PREFIX@/etc/default/untangle-vm

HOST=${1:-localhost}

if ps aux -w -w | grep -q -E 'bin/java.+http://'$HOST'/webstart/.+\.jnlp$' ; then
  echo "Untangle Client already running, aborting..."
  exit 1
fi

echo "Initializing Webstart configuration: ${HOME}/.java/.deployment/deployment.properties"
${JAVA_HOME}/bin/javaws -updateVersions

#echo "Attempting to clear Webstart cache"
#${JAVA_HOME}/bin/javaws -Xclearcache

webstartURL=http://$HOST/webstart/gui.jnlp

echo "Webstarting Untangle Client.  Connecting to: $webstartURL"
exec ${JAVA_HOME}/bin/javaws -Xnosplash $webstartURL
