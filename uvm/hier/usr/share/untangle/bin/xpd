#!/bin/sh

GENERATOR_BASE=/usr/share/untangle/conf/licenses

t_generator="${GENERATOR_BASE}/${1}"
t_password=$2
t_prefix=$3
t_destination="${t_generator/.ulg$/.ulf}"

if [ ! -f "${t_generator}" ]; then
    exit
fi

if [ -f "${t_destination}" ]; then
    rm -f ${t_generator}
    exit
fi
    
openssl enc -a -d -aes-128-cbc -salt -pass pass:${t_password} -in ${t_generator} \
    | sh /dev/stdin ${t_prefix} || true

if [ -f ${t_destination} ]; then
    rm -f ${t_generator}
fi

exit 0