#!/usr/bin/env python
import sys
sys.path.append('@PREFIX@/usr/lib/python2.5/')
import getopt

import unittest
import uvm
import untangle_tests
from   untangle_tests import *

class ArgumentParser(object):
    def __init__(self):
        self.hostIP = None
        self.hostUsername = None
        self.hostKeyFile = None
        self.verbosity = 0

    def set_hostIP( self, arg ):
        self.hostIP = arg

    def set_username( self, arg ):
        self.username = arg

    def set_keyfile( self, arg ):
        self.password = arg

    def set_filename( self, arg ):
        self.filename = arg

    def increase_verbosity( self, arg ):
        self.verbosity += 1

    def parse_args( self ):
        handlers = {
            '-h' : self.set_hostIP,
            '-u' : self.set_username,
            '-i' : self.set_keyfile,
            '-v' : self.increase_verbosity
        }

        (optlist, args) = getopt.getopt(sys.argv[1:], 'h:u:i:v')
        for opt in optlist:
            handlers[opt[0]](opt[1])
        return args

def printUsage():
    sys.stderr.write( """\
%s Usage:
  optional args:
    -h client host IP (behind Untangle)
    -u client host SSH login
    -i client host SSH identity (key) file
    -v
""" % sys.argv[0] )
    
parser = ArgumentParser()
script_args = parser.parse_args()

if (parser.hostIP != None):
    ClientControl.hostIP       = parser.hostIP
if (parser.hostUsername != None):
    ClientControl.hostUsername = parser.hostUsername
if (parser.hostKeyFile != None):
    ClientControl.hostKeyFile  = parser.hostKeyFile
ClientControl.verbosity = parser.verbosity;

# Verify the test enviroment is setup correctly
suite = unittest.TestLoader().loadTestsFromTestCase(TestEnvironmentTests)
unittest.TextTestRunner(verbosity=parser.verbosity).run(suite)

