<?xml version="1.0" encoding="UTF-8"?>
<!-- Created using an evaluation version of JasperAssistant (http://www.jasperassistant.com) -->
<!DOCTYPE jasperReport PUBLIC "-//JasperReports//DTD Report Design//EN" "http://jasperreports.sourceforge.net/dtds/jasperreport.dtd">

<jasperReport name="SpywareClients" whenNoDataType="AllSectionsNoDetail" pageWidth="276" pageHeight="791" columnWidth="276" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" isFloatColumnFooter="true">
    <import value="java.util.*"/>
    <import value="net.sf.jasperreports.engine.*"/>
    <import value="net.sf.jasperreports.engine.data.*"/>
    <parameter name="startTime" class="java.sql.Timestamp">
    </parameter>
    <parameter name="endTime" class="java.sql.Timestamp">
    </parameter>
    <queryString><![CDATA[
    SELECT name, count(name) AS count, total_count
FROM (SELECT count(*) AS total_count FROM tr_spyware_evt_access AS evt
      WHERE evt.time_stamp > $P{startTime} AND evt.time_stamp < $P{endTime}) AS foo,
     tr_spyware_evt_access evt
JOIN pl_endp endp USING (session_id)
JOIN merged_address_map mam ON addr = c_client_addr AND evt.time_stamp >= mam.start_time AND evt.time_stamp < mam.end_time
WHERE evt.time_stamp > $P{startTime}
AND evt.time_stamp < $P{endTime}
GROUP BY name, total_count
ORDER BY count DESC
]]></queryString>
    <field name="name" class="java.lang.String">
    </field>
    <field name="count" class="java.lang.Long">
    </field>
    <field name="total_count" class="java.lang.Long">
    </field>
    <variable name="n" class="java.lang.Integer" calculation="Count">
        <variableExpression><![CDATA[$F{name}]]></variableExpression>
    </variable>
    <background>
        <band>
        </band>
    </background>
    <title>
        <band height="14">
            <staticText>
                <reportElement key="staticText" positionType="Float" mode="Opaque" x="53" y="0" width="169" height="14"/>
                <box topBorder="None" topBorderColor="#0" leftBorder="None" leftBorderColor="#0" bottomBorder="None" bottomBorderColor="#0" rightBorder="None" rightBorderColor="#ffffff"/>
                <textElement textAlignment="Center">
                    <font fontName="SansSerif" size="10" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
                </textElement>
                <text><![CDATA[Spyware Clients]]></text>
            </staticText>
        </band>
    </title>
    <pageHeader>
        <band height="13">
            <staticText>
                <reportElement key="staticText" positionType="Float" mode="Opaque" x="0" y="0" width="169" height="13"/>
                <box topBorder="None" topBorderColor="#0" leftBorder="None" leftBorderColor="#0" bottomBorder="None" bottomBorderColor="#0" rightBorder="None" rightBorderColor="#ffffff"/>
                <textElement>
                    <font fontName="SansSerif" size="9" isBold="false" isItalic="true" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
                </textElement>
                <text><![CDATA[User]]></text>
            </staticText>
            <staticText>
                <reportElement key="staticText" positionType="Float" mode="Opaque" x="172" y="0" width="62" height="13"/>
                <box topBorder="None" topBorderColor="#0" leftBorder="None" leftBorderColor="#0" bottomBorder="None" bottomBorderColor="#0" rightBorder="None" rightBorderColor="#ffffff"/>
                <textElement textAlignment="Right">
                    <font fontName="SansSerif" size="9" isBold="false" isItalic="true" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
                </textElement>
                <text><![CDATA[Count]]></text>
            </staticText>
            <staticText>
                <reportElement positionType="Float" x="234" y="0" width="42" height="13"/>
                <textElement textAlignment="Right">
                    <font fontName="SansSerif" size="9" isItalic="true"/>
                </textElement>
                <text><![CDATA[%]]></text>
            </staticText>
        </band>
    </pageHeader>
    <columnHeader>
        <band>
        </band>
    </columnHeader>
    <detail>
        <band height="13">
            <printWhenExpression><![CDATA[new Boolean($V{n}.intValue() < 20)]]></printWhenExpression>
            <textField pattern="">
                <reportElement key="textField" positionType="Float" mode="Opaque" x="172" y="0" width="62" height="13"/>
                <box topBorderColor="#0" leftBorderColor="#0" bottomBorderColor="#0" rightBorderColor="#ffffff"/>
                <textElement textAlignment="Right">
                    <font fontName="Monospaced" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
                </textElement>
                <textFieldExpression class="java.lang.Long"><![CDATA[$F{count}]]></textFieldExpression>
            </textField>
            <textField pattern="">
                <reportElement key="textField" positionType="Float" mode="Opaque" x="0" y="0" width="169" height="13"/>
                <box topBorderColor="#0" leftBorderColor="#0" bottomBorderColor="#0" rightBorderColor="#ffffff"/>
                <textElement>
                    <font fontName="SansSerif" size="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
                </textElement>
                <textFieldExpression class="java.lang.String"><![CDATA[$F{name}]]></textFieldExpression>
            </textField>
            <textField>
                <reportElement positionType="Float" x="234" y="0" width="42" height="13"/>
                <textElement textAlignment="Right">
                    <font fontName="Monospaced" size="9" isItalic="true"/>
                </textElement>
                <textFieldExpression class="java.lang.String"><![CDATA[Math.round($F{count}.doubleValue() / $F{total_count}.doubleValue() * 100) + "%"]]></textFieldExpression>
            </textField>
        </band>
    </detail>
    <columnFooter>
        <band height="13">
            <textField pattern="">
                <reportElement key="textField" positionType="Float" mode="Opaque" x="172" y="0" width="62" height="13"/>
                <box topBorder="None" topBorderColor="#0" leftBorder="None" leftBorderColor="#0" bottomBorder="None" bottomBorderColor="#0" rightBorder="None" rightBorderColor="#ffffff"/>
                <textElement textAlignment="Right">
                    <font fontName="Monospaced" size="9" isBold="true" isItalic="true" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
                </textElement>
                <textFieldExpression class="java.lang.Long"><![CDATA[$F{total_count}]]></textFieldExpression>
            </textField>
            <staticText>
                <reportElement key="staticText" positionType="Float" mode="Opaque" x="0" y="0" width="169" height="13"/>
                <box topBorder="None" topBorderColor="#0" leftBorder="None" leftBorderColor="#0" bottomBorder="None" bottomBorderColor="#0" rightBorder="None" rightBorderColor="#ffffff"/>
                <textElement>
                    <font fontName="SansSerif" size="9" isBold="true" isItalic="true" isUnderline="false" isStrikeThrough="false" pdfFontName="Helvetica" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
                </textElement>
                <text><![CDATA[Totals:]]></text>
            </staticText>
            <staticText>
                <reportElement positionType="Float" x="234" y="0" width="42" height="13"/>
                <textElement textAlignment="Right">
                    <font fontName="Monospaced" size="9" isBold="true" isItalic="true"/>
                </textElement>
                <text><![CDATA[100%]]></text>
            </staticText>
        </band>
    </columnFooter>
    <pageFooter>
        <band height="30">
        </band>
    </pageFooter>
    <summary>
        <band>
        </band>
    </summary>
</jasperReport>
