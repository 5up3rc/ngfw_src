<html xmlns:jsp="http://java.sun.com/JSP/Page"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:uvm="http://java.untangle.com/jsp/uvm"
      xmlns="http://www.w3.org/1999/xhtml">
  
  <jsp:directive.page import="java.net.URLEncoder"/>
  <jsp:directive.page import="java.util.Random"/>
  <jsp:directive.page import="com.untangle.node.http.BlockDetails"/>

  
  <jsp:scriptlet>
    <![CDATA[
             BlockDetails blockDetails = (BlockDetails)request.getAttribute( "bd" );
             StringBuilder urlParams = new StringBuilder();
             Object tempObject;
             urlParams.append( "h=" );
             tempObject = blockDetails.getHost();
             if ( tempObject == null ) tempObject = "";
             urlParams.append( URLEncoder.encode( tempObject.toString(), "UTF-8" ));
             urlParams.append( "&u=" );
             tempObject = blockDetails.getUrl();
             if ( tempObject == null ) tempObject = "";
             urlParams.append( URLEncoder.encode( tempObject.toString(), "UTF-8" ));
             urlParams.append( "&r=" );
             tempObject = request.getAttribute( "reason" );
             if ( tempObject == null ) tempObject = "";
             urlParams.append( URLEncoder.encode( tempObject.toString(), "UTF-8" ));
             urlParams.append( "&c=" );
             urlParams.append( URLEncoder.encode( String.valueOf( new Random().nextInt(Integer.MAX_VALUE)), "UTF-8" ));
             request.setAttribute( "urlParams", urlParams.toString());
    ]]>
  </jsp:scriptlet>

  <jsp:output omit-xml-declaration="true"
      doctype-root-element="html"      
      doctype-public="-//W3C//DTD XHTML 1.0 Strict//EN"
      doctype-system="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"/>
  
  <jsp:directive.page contentType="text/html"/>

  <head>
    <meta content="IE=7.0000" http-equiv="X-UA-Compatible"/>  
    <link rel="icon"  type="image/png" href="/images/block-favicon.png"/>  
    <title><c:out value="${pageTitle}"/></title>

    <uvm:skin src="user.css" name="${ss.userPagesSkin}"/>
    <c:if test="${!untangle_plus}">
      <script type="text/javascript" ><!-- --></script>
    </c:if>

    <uvm:inlineScript>
      <![CDATA[
          var nonce = '${param.nonce}';
          var tid = '${param.tid}';
          var url = '${bd.url}';
      ]]>
    </uvm:inlineScript>
    
    <c:if test="${!empty javascript_file}">
      <script type="text/javascript" src="${javascript_file}"><!-- --></script>
    </c:if>

    <c:out escapeXml="false" value="${javascript}"/>
  </head>
  
  <body id="simple" class="blockpage">
    <div id="content" style="width:728px !important;padding:0px 0px 0px !important;margin-bottom:0px !important">
      <div id="header" style="margin:3px !important;">
        <a href="${bs.companyUrl}"><img src="/images/BrandingLogo.gif" alt=""/></a>
        <div class="title"><c:out value="${title}" escapeXml="false"/></div>
      </div>
      
      <div id="main" style="top: auto !important;height:auto !important;position:relative !important;">
        <p class="icon-block">
            <br/>
        </p>
        <p class="description" style="text-align:left;">
          <span>${description}</span>
          <br/>
          
          <span style="font-size:8pt;">${contact}</span>
        </p>
        <p class="contact" style="bottom:110px !important;left:70px;">

        </p>        
        <div class="info-list">
          <div><b><uvm:i18n>Host:</uvm:i18n></b> <c:out value="${bd.formattedHost}"/></div>
          <div><b><uvm:i18n>URL:</uvm:i18n></b> <c:out value="${bd.formattedUrl}"/></div>
          <c:if test="${!empty reason}">
            <div><b><uvm:i18n>Reason:</uvm:i18n></b> <c:out value="${reason}"/></div>
          </c:if>
        </div>
        
        <c:if test="${!empty additional_fields}">
          ${additional_fields}
        </c:if>
        <div class="u-form-item">
            <c:if test="${showUnblockNow}">
              <button id="unblockNowButton" type="button" onclick="unblockSite(false)">
                <uvm:i18n>Unblock For Now</uvm:i18n>
              </button>
            </c:if>
            
            <c:if test="${showUnblockGlobal}">
              <button id="unblockGlobalButton" type="button" onclick="unblockSite(true)">
                <uvm:i18n>Unblock Permanently</uvm:i18n>
              </button>
            </c:if>
        </div>
      </div>
              
      <div id="footer">
        <p><span><c:out value="${footer}"/></span></p>
      </div>
      
      <!-- These extra divs/spans may be used as catch-alls to add extra imagery. -->
      <div id="extra-div-1"><span></span></div>
      <div id="extra-div-2"><span></span></div>
      <div id="extra-div-3"><span></span></div>
      <div id="extra-div-4"><span></span></div>
      <div id="extra-div-5"><span></span></div>
      <div id="extra-div-6"><span></span></div>
    </div>
      <c:if test="${!untangle_plus}">
        <script type="text/javascript" src="http://guide.untangle.com/bp/get-status-2.php?${urlParams}"><!-- --></script>
      </c:if>    
  </body>
</html>
