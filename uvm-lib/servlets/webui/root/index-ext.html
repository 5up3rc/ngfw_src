<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" >
<head>
    <title>Untangle rack - ext model</title>
    
    <style type="text/css">
        @import "ext-2.0/resources/css/ext-all.css";
        @import "untangle.css";
    </style>
<!--
	<script type="text/javascript" src="ext-2.0/source/core/Ext.js"></script>
	<script type="text/javascript" src="ext-2.0/source/adapter/ext-base.js"></script>
	<script type="text/javascript" src="ext-2.0/ext-all-debug.js"></script>
-->
	<script type="text/javascript" src="ext-2.0/adapter/ext/ext-base.js"></script>
	<script type="text/javascript" src="ext-2.0/ext-all.js"></script>
    <script type="text/javascript" src="script/graphics.js"></script>
    <script type="text/javascript" src="script/ext-untangle.js"></script>
<script type="text/javascript">
	var _isExt=true;
	var tools= null;
	var nodes= null;
	MainPage = function() {}
	MainPage.tabs=null;
	MainPage.buttonTemplate=null;
	MainPage.loadTools = function() {
		Ext.Ajax.request({
			url : "requests/tools.json" , 
			method: 'GET',
			success: function ( result, request) { 
				tools=Ext.util.JSON.decode(result.responseText);
				MainPage.buildTools();
			},
			failure: function ( result, request) { 
				Ext.MessageBox.alert('Failed', 'Successfully posted form: '+result.date); 
			} 
		});	
	}
	MainPage.loadNodes = function() {
		Ext.Ajax.request({
			url : "requests/nodes.json" , 
			method: 'GET',
			success: function ( result, request) { 
				nodes=Ext.util.JSON.decode(result.responseText).nodes;
				MainPage.buildRacks();
			},
			failure: function ( result, request) { 
				Ext.MessageBox.alert('Failed', 'Successfully posted form: '+result.date); 
			} 
		});				
	}
	MainPage.buildTabs = function () {
		MainPage.tabs = new Ext.TabPanel({
		    renderTo: 'tabs',
		    'activeTab': 0,
		    'height':400,
		    'defaults':{autoScroll: true},
		    'items':[
		        {'contentEl':'tabLibrary', 'title':'Library'},
		        {'contentEl':'tabMyApps', 'title':'My Apps'},
		        {'contentEl':'tabConfig', 'title':'Config'}
		    ]
		});
	}
	
	MainPage.buildTools = function() {
		MainPage.buildTabs();
		MainPage.buildLibrary();
		MainPage.buildMyApps();
		MainPage.buildConfig();
	}
	MainPage.buildLibrary = function() {
  		var out=[];
  		for(var i=0;i<tools.library.length;i++) {
  			var item=tools.library[i];
  			out.push(MainPage.buttonTemplate.applyTemplate({'class':'toolboxButton libraryButton','label':item.label,'imageSrc':item.image,'onClick':'MainPage.clickToolsButton(tools.library['+i+'])'}));
  		}
  		document.getElementById('toolsLibrary').innerHTML=out.join('');
	}
	MainPage.clickToolsButton = function(item) {
		if(item!=null && item.action!=null) {
			var action=item.action;
			if(item.action.url!=null) {
				window.open(item.action.url);
			} else if(item.action.method!=null) {
				eval(item.action.method);
			}
		}
	}
	
	MainPage.todo=function() {
		alert("TODO: implement this.")
	}
	
	MainPage.buildMyApps = function() {
  		var out=[];
  		for(var i=0;i<tools.myApps.length;i++) {
  			var item=tools.myApps[i];
  			out.push(MainPage.buttonTemplate.applyTemplate({'class':'toolboxButton libraryButton','label':item.label,'imageSrc':item.image,'onClick':'MainPage.clickToolsButton(tools.myApps['+i+'])'}));
  		}
  		document.getElementById('toolsMyApps').innerHTML=out.join('');
	}
	
	MainPage.buildConfig = function() {
  		var out=[];
  		for(var i=0;i<tools.config.length;i++) {
  			var item=tools.config[i];
			out.push(MainPage.buttonTemplate.applyTemplate({'class':'toolboxButton configButton','label':item.label,'imageSrc':item.image,'onClick':'MainPage.clickToolsButton(tools.config['+i+'])'}));
  		}
  		document.getElementById('toolsConfig').innerHTML=out.join('');
	}
	MainPage.buildRacks = function () {
		var out=[];
		for(var i=0;i<nodes.length;i++) {
			var node=nodes[i];
			var nodeWidget=new Ext.untangle.Node(node);
			nodeWidget.render('rack_list');
			//alert(nodeWidget.id);
		}
	}
	function init() {
		var buttonTemplate=[];
		buttonTemplate.push('<div class="dijit untangleButton {class}" onClick="{onClick}">');
		buttonTemplate.push('<table border="0" width="100%" height="100%"><tr>');
		buttonTemplate.push('<td width="1%" style="text-align: left;vertical-align: middle;"><img src="{imageSrc}" style="vertical-align: middle;"/></td>');
		buttonTemplate.push('<td style="text-align: left;vertical-align: middle;padding-left:5px;font-size: 14px;">{label}</td>');
		buttonTemplate.push('</tr></table></div>');
		MainPage.buttonTemplate=new Ext.Template(buttonTemplate);
		var aa=new Ext.untangle.Button({
			'height':'46px',
			'width':'86px',
			'renderTo':'help',
	        'text': 'Help',
	        'handler': function() {MainPage.todo()},
	        'imageSrc': 'images/IconHelp36x36.png'
	        });
		MainPage.loadTools();
		MainPage.loadNodes();
	}
	Ext.onReady(init);
</script>
</head>
<body>
<div id="container">
	<div id="contentleft">
		<div id="logo"><img src="images/Logo150x96.gif"/></div>
		<div id="tabs">
		</div>
			<div id="tabLibrary" class="x-hide-display">
			    <div style="margin-left:15px;font-size: 11px;text-align:left;">Click to Learn More</div>
			    <div id="toolsLibrary"></div>
			</div>
			<div id="tabMyApps" class="x-hide-display">
			    <div style="margin-left:15px;font-size: 11px;text-align:left;">Click to Install into Rack</div>
			    <div id="toolsMyApps"></div>
			</div>
			<div id="tabConfig" class="x-hide-display">
               	<div style="margin-left:15px;font-size: 11px;text-align:left;">Click to Configure</div>
               	<div id="toolsConfig"></div>
			</div>
		
 		<div id="help"></div>
	</div>
	<div id="racks">
		<div id="leftBorder"></div>
		<div id="rightBorder"></div>
		<div id="rack_list"></div>
	</div>
	<div id="test"></div>
</div>
</body>
</html>
