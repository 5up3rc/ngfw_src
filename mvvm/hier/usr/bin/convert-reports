#!/bin/sh

REPORT_DIR=@MVVM_WEB@/reports

add_mv_htmlheader()
{
cat >>$hf <<EOF
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <link href="../css/main.css" rel="stylesheet" type="text/css"/>
  </head>
  <body>
    <table cellspacing="0" cellpadding="0" border="0" align="center" class="main">
      <tbody>
        <tr>
          <td class="main-top">
          </td>
        </tr>
        <tr>
          <td class="main-middle">
            <div align=center>
            <a href="$AHREFVAL"><font face="SansSerif" size="-1">back</font></a>
            </div>
EOF
}

add_mv_htmlfooter()
{
cat >>$hf <<EOF
            <div align=center>
            <a href="$AHREFVAL"><font face="SansSerif" size="-1">back</font></a>
            </div>
          </td>
        </tr>
        <tr>
          <td class="main-bottom">
          </td>
        </tr>
      </tbody>
    </table>
  </body>
</html>
EOF
}

ORG_PWD=`pwd`
NEW_PWD=$REPORT_DIR/current
cd $NEW_PWD

for df in `find * -type d`; do
  if [ -f $df/name ]; then
    cd $df
    # note that index-reports uses content of transform name file to create anchor point on index html page
    TNAME=`cat name`

    for hf in `find *.html -type f | grep -v "sum-\(daily\|weekly\|monthly\)\.html"`; do
      # note that update-reports chooses names of index html page files
      echo $hf | grep monthly &> /dev/null
      if [ $? -eq 1 ]; then
        echo $hf | grep weekly &> /dev/null
        if [ $? -eq 1 ]; then
          AHREFVAL=../index.html#$TNAME
        else
          AHREFVAL=../index_online_weekly.html#$TNAME
        fi
      else
        AHREFVAL=../index_online_monthly.html#$TNAME
      fi

      \mv -f $hf $hf.org

      # strip JR look-n-feel
      sed -f @USR_BIN@/convert-reports.sed $hf.org > $hf.new

      # add MV look-n-feel
      add_mv_htmlheader
      cat $hf.new >> $hf
      add_mv_htmlfooter

      \rm -f $hf.org $hf.new
    done

    cd $NEW_PWD
  fi
done

cd $ORG_PWD
