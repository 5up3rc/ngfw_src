#!/bin/sh

. @PREFIX@/etc/default/mvvm

if [ "xreboot" = "$1" ]; then
    pidfile=$MVVM_REBOOT_PIDFILE
elif [ "xrestart" = "$1" ]; then
    pidfile=$MVVM_RESTART_PIDFILE
else
    echo "usage: $0 [ reboot | restart ]"
    exit 1
fi

if [ -e $pidfile ]; then
    if ps p $(cat $pidfile); then
        echo "restart already scheduled"
        exit;
    else
        rm $pidfile
    fi
fi

/etc/init.d/mvvm stop
nohup mvvm-restart-wait $1 >/dev/null 2>&1 &

while [ ! -e $pidfile ]; do true; done
