#!/bin/sh

set -e

ZONE="$1"

if [ ! -f /usr/share/zoneinfo/$ZONE ]; then
    echo "Time zone not found: $ZONE"
    exit 1
fi

echo "$ZONE" > @MVVM_CONF@/timezone

rm -f /etc/localtime
ln -s "/usr/share/zoneinfo/$ZONE" /etc/localtime

grep -sq lang= /boot/grub/menu.lst && sed -i -e "s|\( tz=[^ ]*\)\? lang=| tz=$ZONE lang=|" /boot/grub/menu.lst

# Restart system daemons that depend on timezone
/etc/init.d/ntpdate restart 2>&1 > /dev/null &
/etc/init.d/sysklogd restart
# Must restart spamd whenever syslogd restarts, bug in perl...
if [ -x /etc/init.d/spamassassin ]; then
    /etc/init.d/spamassassin restart
fi    

/etc/init.d/cron restart

exit 0
