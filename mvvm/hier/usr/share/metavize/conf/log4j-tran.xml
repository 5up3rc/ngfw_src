<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE log4j:configuration SYSTEM "log4j.dtd">

<!-- ===================================================================== -->
<!--                                                                       -->
<!--  Log4j Configuration for MVVM                                         -->
<!--                                                                       -->
<!--     Configuration of all mvvm loggers lives here.                     -->
<!--                                                                       -->
<!-- ===================================================================== -->

<!-- $Id$ -->

<!--
   | For more configuration infromation and examples see the Jakarta Log4j
   | website: http://jakarta.apache.org/log4j
 -->


<log4j:configuration xmlns:log4j="http://jakarta.apache.org/log4j/" debug="false">

  <appender name="TranLog" class="org.apache.log4j.RollingFileAppender">
    <param name="File" value="${bunnicula.home}/log/@TranLogFileName@.log"/>
    <param name="Append" value="true"/>
    <param name="MaxFileSize" value="5000KB"/>
    <param name="MaxBackupIndex" value="9"/>
    <param name="Threshold" value="ALL"/>
    <layout class="com.untangle.mvvm.logging.MvPatternLayout">
      <param name="ConversionPattern" value="%D %-5p [%c{1}] &lt;%X{SessionID}&gt; %m%n"/>
    </layout>
  </appender>

  <!-- Log Emailer -->

  <appender name="EmailAppender" class="com.untangle.mvvm.logging.SMTPAppender">
    <!-- Note: We do *not* specify a layout here because we must create it programmatically
         so that we can get the transform name in there.  Instead we provide the Conversion
         Pattern here at the top level so that the SMTPAppender constructor can create the
         correct layout. -->
    <param name="LayoutConversionPattern" value="%D %-5p [%c{1}] &lt;%X{SessionID}&gt; %m%n"/>
  </appender>

  <!-- #      DEBUG           new session debugging -->
  <!-- #      INFO            each new session -->
  <!-- #      WARN            exceptions -->
  <category name="com.untangle.mvvm.tapi.MPipe">
    <priority value="WARN"/>
  </category>

  <category name="com.untangle.mvvm.tapi.Dispatcher">
    <priority value="WARN"/>
  </category>

  <!-- # Session Event messages: all events delivered to transform, logged just before delivery -->
  <!-- # from the delivery/execution thread. -->
  <!-- #      DEBUG          Data events -->
  <!-- #      INFO           shutdown, close, other session events. -->
  <!-- #      WARN           New session, new session request events -->
  <category name="com.untangle.mvvm.tapi.SessionEvent">
    <!-- No logging by default -->
    <priority value="ERROR"/>
  </category>

  <!-- # Internal Session messages, -->
  <!-- #      DEBUG           session read/write state change, read/write statistics -->
  <!-- #      INFO            (currently same as WARN) -->
  <!-- #      WARN             exceptions or unusual conditions  -->
  <category name="com.untangle.mvvm.tapi.Session">
    <priority value="WARN"/>
  </category>

  <category name="com.untangle.mvvm.tapi.TCPSession">
    <priority value="WARN"/>
  </category>

  <category name="com.untangle.mvvm.tapi.UDPSession">
    <priority value="WARN"/>
  </category>

  <category name="com.untangle.mvvm.tapi.SessionTimes">
    <priority value="WARN"/>
  </category>

  <category name="com.untangle.tran.token">
    <priority value="WARN"/>
  </category>

  <category name="com.untangle.tran.virus">
    <priority value="WARN"/>
  </category>

  <category name="com.untangle.tran.clam">
    <priority value="WARN"/>
  </category>

  <category name="com.untangle.tran.hauri">
    <priority value="WARN"/>
  </category>

  <category name="com.untangle.tran.spam">
    <priority value="WARN"/>
  </category>

  <category name="com.untangle.tran.spamassassin">
    <priority value="WARN"/>
  </category>

  <category name="com.untangle.tran.clamphish">
    <priority value="WARN"/>
  </category>

  <category name="com.untangle.tran.ftp">
    <priority value="WARN"/>
  </category>

  <category name="com.untangle.tran.http">
    <priority value="ALL"/>
  </category>

  <category name="com.untangle.tran.mail">
    <priority value="WARN"/>
  </category>

  <category name="com.untangle.tran.httpblocker">
    <priority value="ALL"/>
  </category>

  <category name="com.untangle.tran.ids">
    <priority value="INFO"/>
  </category>

  <category name="com.untangle.tran.protofilter">
    <priority value="WARN"/>
  </category>

  <category name="com.untangle.tran.spyware">
    <priority value="WARN"/>
  </category>

  <category name="com.untangle.mvvm.tran">
    <priority value="WARN"/>
  </category>

  <category name="com.untangle.tran">
    <priority value="WARN"/>
  </category>

  <category name="net.sf.hibernate">
    <priority value="WARN"/>
  </category>

  <category name="org.apache.catalina">
    <priority value="WARN"/>
  </category>


  <!-- ======================= -->
  <!-- Setup the Root category -->
  <!-- ======================= -->

  <!-- All Transform logs go to individual transform log files -->
  <root>
    <priority value="WARN"/>
    <appender-ref ref="TranLog"/>
    <appender-ref ref="EmailAppender"/>
  </root>
</log4j:configuration>
