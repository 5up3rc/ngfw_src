#!/bin/bash
##
## Remove the invisible flag from IDPS node properties.
##
## This file (and the postinst check/call) can be removed 
## after the 11.x release
##

SOURCE_FILE_NAME=/usr/share/untangle/lib/untangle-node-idps/nodeProperties.js
TEMP_FILE_NAME=/tmp/idps_nodeProperties.js
FLAG_FILE_NAME=/usr/share/untangle/conf/idps_beta_flag 

function removeinvisible {
    sed '/"invisible": true,/d' $SOURCE_FILE_NAME > $TEMP_FILE_NAME
    mv -f $TEMP_FILE_NAME $SOURCE_FILE_NAME
}

if [ "$1" == "enable" ] ; then
    touch $FLAG_FILE_NAME
    removeinvisible
    /etc/init.d/untangle-vm restart
elif [ "$1" == "checkset" ] ; then
    if [ -f $FLAG_FILE_NAME ] ; then
        removeinvisible
    fi
else
    echo "To enable IDPS beta, type:"
    echo $0 enable
    exit
fi
