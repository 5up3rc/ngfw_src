#! /bin/bash

if [ $# -eq 0 ]; then
    echo "usage: $0 [ uvm | node ]"
    exit 1
fi

source @PREFIX@/etc/default/untangle-vm

uvm_lib=../output/usr/share/untangle/lib
third_lib=../output/usr/share/java/uvm
toolbox=../output/usr/share/untangle/toolbox

for j in $uvm_lib/*jar $third_lib/*jar $toolbox/*mar; do
    CLASSPATH="$j:$CLASSPATH"
done

uvm_hbms=$(find ../uvm/output/gensrc -name '*hbm.xml')

for c in $@; do
    if [ $c != "uvm" ]; then
        node_hbms="node_hbms $(find ../output/gensrc/$c -name '*hbm.xml')"
    fi
done

hibernate_props=../output/usr/share/untangle/conf/hibernate.properties

$JAVA_HOME/bin/java -cp "$CLASSPATH" \
    org.hibernate.tool.hbm2ddl.SchemaExport \
    --properties="$hibernate_props" --text $uvm_hbms $node_hbms
