#! /bin/bash

dir="$1"

echo "Fixing hbm.xml in $dir"

find "$dir" -name '*hbm.xml' -exec sed -i \
    -e 's/Hibernate Mapping DTD 2.0/Hibernate Mapping DTD 3.0/' \
    -e 's/hibernate-mapping-2.0.dtd/hibernate-mapping-3.0.dtd/' \
    -e 's/<hibernate-mapping *$/<hibernate-mapping default-lazy="false"/' \
    '{}' ';'

util=$(dirname $0)
util_classes=$util/output/util
hibernate_jar=$util/../downloads/output/hibernate-3.0/hibernate3.jar
dom4j_jar=$util/../downloads/output/hibernate-3.0/lib/dom4j-1.6.jar
jaxen_jar=$util/../downloads/output/hibernate-3.0/lib/jaxen-1.1-beta-4.jar

find "$dir" -name '*hbm.xml' | xargs /usr/bin/java -cp $util_classes:$hibernate_jar:$dom4j_jar:$jaxen_jar DomSerializer