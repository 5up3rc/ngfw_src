#! /bin/bash

# Creates a hibnernate-client.jar with the subset of classes required
# to use objects serialized from a Hibernate Session.

# Aaron Read <amread@untangle.com>

unpacked=$(mktemp -d)
closure=$(mktemp)

(cd $unpacked && jar xf @THIRDPARTY_UVM_LIB@/hibernate3.jar)

cat @UVM_HOME@/buildutils/hibernate-client.list \
    | xargs @USR_BIN@/closure -cp $unpacked compute-closure \
    | grep hibernate \
    | sed -e 's|\.|/|g' -e 's/^\(.*\)$/\1.class/' \
    | sort | uniq >$closure

outdir=$PWD

(cd $unpacked && jar cf $outdir/hibernate-client.jar @$closure)

rm -r $unpacked
rm $closure
