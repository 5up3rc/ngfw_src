#! /bin/bash

# Creates a hibnernate-client.jar with the subset of classes required
# to use objects serialized from a Hibernate Session.

# Aaron Read <amread@untangle.com>

unpacked=$(mktemp -d)
closure=$(mktemp)

(cd $unpacked && jar xf @THIRDPARTY_UVM_LIB@/hibernate3.jar)

xargs @USR_BIN@/closure -cp $unpacked compute-closure < @UVM_HOME@/buildutils/hibernate-client.list \
 | awk '/hibernate/ {gsub(/\./, "/", $1) ; print $1 . ".class"}' \
 | sort -u > $closure

outdir=$PWD

(cd $unpacked && jar cf $outdir/hibernate-client.jar @$closure)

rm -r $unpacked
rm $closure
