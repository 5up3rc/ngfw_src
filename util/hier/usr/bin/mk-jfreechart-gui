#! /bin/bash

# Creates a jfreechart-gui.jar with the subset of classes required for
# our swing client.

# Aaron Read <amread@untangle.com>

util_dir=$(pwd)
jfreechart_home=$util_dir/../downloads/output/jfreechart-1.0.1

unpacked=$(mktemp -d)
closure=$(mktemp)

(cd $unpacked && jar xf $jfreechart_home/jfreechart-1.0.1.jar && jar xf $jfreechart_home/jcommon-1.0.0.jar)

cat jfreechart-gui.list \
    | xargs ./closure -cp $unpacked compute-closure \
    | grep jfree \
    | sed -e 's|\.|/|g' -e 's/^\(.*\)$/\1.class/' | sort | uniq >$closure

(cd $unpacked && jar cf $util_dir/jfreechart-gui.jar @$closure $(find . -name '*.properties'))

rm -r $unpacked
rm $closure
